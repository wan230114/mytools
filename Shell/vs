grep `id -g` /etc/passwd|awk -F":" '{id=$1","id}END{cmd="qstat -u "id;system(cmd)}'|awk 'BEGIN{days=60*60*24;hours=60*60;mins=60;secs=1;OFS="\t";"date \"+%Y%m%d %H:%M:%S\""|getline today;"date +%s -d \""today"\""|getline today_date;}{if(FNR<3)next;p=$4;stat=$5;date=$6" "$7;"date +%s -d \""date"\""|getline b;usetime=today_date-b;usetimehash[p,stat]+=usetime;mindate=early[p,stat];if(!mindate)early[p,stat]=b;if(b<mindate)early[p,stat]=b;hash[p,stat]++;total[stat]++;all++;}END{for (m in hash){ usetime=usetimehash[m];tmpu=usetime/hash[m];avg=tmpu;if(tmpu>secs){avg=avg"(sec)"};if(tmpu>mins){avg=tmpu/mins;avg=avg"(mins)"};if(tmpu>hours){avg=tmpu/hours;avg=avg"(hours)"};if(tmpu>days){avg=tmpu/days;avg=avg"(days)"};split(m,arr,SUBSEP); long=today_date-early[m];tmp=long;if(tmp>secs){long=tmp/secs;long=long"(sec)"};if(tmp>mins){long=tmp/mins;long=long"(mins)"};if(tmp>hours){long=tmp/hours;long=long"(hours)"};if(tmp>days) {long=tmp/days;long=long"(days)"};printf "%-15s%-15s%-15s%-15s%-15s\n", arr[1],arr[2],hash[m],long, avg } print("-----------"); for(i in total) print i,total[i];print "Total:\t"all}'
